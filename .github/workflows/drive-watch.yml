name: Drive Watch (Raw Clips)

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch: {}

permissions:
  contents: write
  issues: write

jobs:
  watch:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install deps
        run: |
          npm -v || true
          corepack enable
          npm i googleapis@131 node-fetch@2.6.9

      - name: Run watcher
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GDRIVE_SA_JSON: ${{ secrets.GDRIVE_SA_JSON }}
          RAW_CLIPS_FOLDER_ID: ${{ secrets.RAW_CLIPS_FOLDER_ID }}
          WORKER_URL: ${{ secrets.WORKER_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          REPO_OWNER: ${{ github.repository_owner }}
          REPO_NAME: ${{ github.event.repository.name }}
        run: node scripts/drive_watch.mjs

